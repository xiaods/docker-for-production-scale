# 前言

容器技术作为底层基础软件设施的核心技术，其核心价值主要是提高了对业务应用运行时的隔离性和虚拟化性能。在近些年来云计算领域中容器、微服务、开发运维实践\(DevOps\)等技术的推动发展下，软件开发人员遇到了前所未有的基础设施搭建的困境需要解决。公有云如亚马逊，私有云如Openstack等都仅仅提供了开发部署业务需要的基础组件，所有搭建应用平台的基础设施过程，基本都是依赖资深开发运维工程师的经验来支撑，水平也呈现良莠不齐的困境。在为了解决业务不断扩张中力不从心的情况，业内创业者开始搭建各自理解的PaaS平台服务，业内知名的如Heroku就是在这样的背景下迅速发展起来的。基于公有云组件服务之上搭建的PaaS平台虽然能解决一些应用部署分发的问题，但是大量的企业用户仍然面临更大的困境，存在大量现成的基础设施资源无法复用。所以，企业内部的开发者一般会选择开源软件去构建自己的应用开发部署平台。随着容器开源技术Docker的快速引入，大家逐渐注意到以Docker、Kubernetes为核心的优秀容器工具链可以帮助开发者在很少的资源投入下就可以构建出标准的企业应用集成设施平台。经过5年多容器技术的发展，Linux基金会发起成立云原生计算基金会（CNCF），引导开源软件的使用者搭建标准可参考的企业级云基础设施架构。

## 1. 为国内容器技术用户使用的工具书

容器工具 Docker 仅是一个命令行可执行文件并在使用体验上简单易懂，但是它对Linux系统背景知识的要求很高，需要开发者对应用的启动流程、Linux内核系统知识熟悉之后才能真正的掌握容器运行的整个生命过程。笔者正是基于这个痛点问题，决定结合自己这几年的切身实践经验，系统性的整理出对应用容器化有帮助的实践方法工具书。在孕育构思这样一本实践工具书的过程中，笔者经历了2015年在InfoQ技术大会上介绍容器技术时感受到的学习热潮，2016年国内企业开始在落地容器化应用中遇到各种Docker工具链的问题，2017年国内企业开始全面转向CNCF云原生基金会支持下的容器工具链Kubernetes生态中，Docker工具链开始被国内社区边缘化，再到2018年容器技术开始百花齐放，国内企业在应用容器化过程中技术栈的选择多了，困扰也多了起来。这里反映出一个实际的问题是：对于国内企业在尝试落地容器技术过程中遇到的问题，我们很难从国际主流的容器技术公司例如Docker公司那里获得第一手的技术实践知识。大量的国内容器技术的经验积累实际上都是靠国内容器用户自己整理和社区的分享力量才得到的第一手的资料，其中遇到的很多问题都是在用户不确定性和反复尝试的迭代中得到验证并开始推广。所以，本书与其他类别的容器技术书不同的地方在于围绕国内容器技术爱好者的痛点，系统完整的讲清楚容器技术的方方面面需要注意的事项和一些实践思路，帮助大家在遇到问题的时候可以直接拿来参考对比。

## 2. 容器技术到底应该怎么学

从实践的角度来看，把应用打包成容器镜像，并部署到容器集群这个过程是大家最基本的学习需求。但是因为容器运行之后，整个生命周期的管理仍然需要规划和自动化处理才能支撑业务运行需要。所以，不管你是要实现持续集成、持续发布还是持续部署，怎么把容器技术注入进去都需要花点心思来学习才能掌握它。首先，从最基本的Docker命令行工具开始熟悉是最佳选择，然后是Kubernetes命令行工具kubectl的使用介绍。这些都是容器技术使用过程中最常见的命令行工具。有了这些容器工具的使用经验之后，我们开始探讨容器核心技术的关键点：虚拟化性能和隔离性。作为新一代的虚拟化技术，容器技术基于Linux Kernel的Cgroup和Namespace的支持，以进程的角度来虚拟化应用，并且在隔离性上也能获得和真实虚拟化技术KVM等类似的效果。因为去掉了对Hypervisor的依赖，虚拟化性能各项指标可以更强，虚拟化的密度可以更大，这些优点也是容器技术最吸引人的地方。

在我们预览完容器核心技术之后，就会转向一个更实际的话题，也就是如何在DevOps实践中应用容器技术。我觉得这里面最有意思的第一个问题是，容器技术的推广到底是由运维人员推动的还是由开发人员推动的。我们从利弊分析中可以知道，因为要推广容器技术，运维需要学习掌握大量Linux Kernel的开发知识才能掌握容器技术，这对运维人员来说无疑增加了很大的学习负担和工作成本。从开发人员来说，除了前期的容器文件Dockerfile的编写，基本上开发并没有什么工作量，并且因为用了容器技术，开发可能更多的是专注开发环境的开发，把大量是适配容器技术的工作推给了运维人员。因为业务复杂度的不断提高，如果运维人员不调整心态拥抱变化是无法适应容器技术的落地需要的。所以，容器运维的人员的工作职责更重，自动化运维开发的需求越多，也催生了运维圈里的新角色，运维架构师，国外对应的职位名称为SRE\(Site Reliability Engineer\)。有趣的历史巧合是，当前容器技术的主要布道者Google公司也是SRE这个角色的主要布道者。

随着DevOps完整容器技术的落地，我们需要了解如何搭建容器集群Kubernetes平台。在搭建平台的过程中，我们还要涉及到存储、网络、多租户安全配置等多个实际问题的实践。虽然网络上已经有大量的指导手册，我们仍然要清楚的是，如何理解其中的原理并定制化自己需要的集成方案。因为开源技术本身就是提供的组件，作为企业中你需要有这个能力能组装这些软件，并配置出自己需要的容器方案。然后，笔者将通过一个完整的Springboot微服务项目的构建，测试到发布的过程，解读一些业界的最佳实践方法。通过真实案例的分析理解，让读者能对容器技术落地的方方面面有更深入的了解。

从应用分发的角度上来讲，Kubernetes容器技术社区提供了Helm这样的应用打包的仓库，帮助用户能构建自己的应用商店，通过配置可以做到一键安装。在2018年CNCF北美大会上，微软和Docker公司联合发布了增强版本的云原生应用封装规范（CNAB，Cloud Native Application Bundle），让用户可以通过命令行工具就可以维护管理好自己的软件系统包，让应用分发更标准。

除了介绍一些落地集成方面的容器技术，笔者也注意到业界对富容器技术的推出。我们知道传统的虚拟化技术在隔离性上非常强，只是在虚拟化性能上弱于容器技术，那么有没有结合传统虚拟化技术的强项和容器技术的强项，打造的容器技术方案呢。答案就是富容器技术。笔者将介绍3种典型的工具代表如阿里巴巴的Pouch Container，Intel的Kata Container和Google的gVisor技术实践，帮助容器技术的爱好者更深入的了解这些技术的利弊，在实际的业务场景中，可以结合之前的容器技术经验有选择的集成到自己企业的应用开发平台中，这些势必会给你的业务需求落地带来更多的选择。

总而言之，容器技术并非看上去那么简单直白，它包含了众多云计算技术的优点，奠定了云基础设施核心技术之一。读者通过本身整理过的系统性的容器技术，可以在未来的数字化转型的过程中，充分理解容器技术的利弊，更好的服务于企业业务的需要。

因为笔者的技术经验有限，难免在编排整理本书的过程中写入了一些理解错误和描述不准确的问题，请读者在遇到此类问题之后可以统一联系笔者邮箱：xiaods@gmail.com，不胜感激。谢谢。





