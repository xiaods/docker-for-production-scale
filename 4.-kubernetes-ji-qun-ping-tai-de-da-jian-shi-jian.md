---
description: 一台主机的容器总是有办法管理的，当多台主机的容器需要管理时就麻烦起来。
---

# 第4章 容器编排系统应用实践

容器编排集群系统领域，开源系统包括Mesos、Docker Swarm、Kubernetes、Openshift、Nomad等。目前业界主流的容器编排系统已经从群雄逐鹿变为一家独大，这就是由两千多名开源开发者鼎力支持的开源容器编排系统Kubernetes，秉承谷歌内部容器操作系统Borg的生产实践精华。所以，本章从用户实际需求角度出发，将重点围绕Kubernetes系统作为参考编排系统，收集整理出容器编排落地过程中的实战成果，让读者可以在开展自身业务时遇到容器编排问题时可以参考学习。

## 4.1 无状态应用编排范式实践

## 4.2 有状态应用编排范式实践

## 4.3 自动扩容编排技术实战

容器的水平扩展能力一直是应用运维人员非常期待的能力，以至于在Kubernetes还没有这项能力经验之前，很多用户已经开始自研定制化的容器扩容服务。通过在容器集群系统的旁路安装部署一个独立的自动扩容服务，就可以按照一定的业务规则调用Kubernetes Api Server指挥容器进行扩容。但是在真正实际落地这项技术的时候，我们会发现有如下痛点无法解决：

1. 容器主机是固定数量，一般就限定了容器的总容量。所以自动扩容的能力是收到主机资源的成本限制的。
2. 容器扩容的指标过于简单，考虑到应用何时应该扩容的决策因素在实际场景中并不会简单采用CPU和内存的大小来简单决策。
3. 自动扩容的方式存在两种方式，一种是只扩不缩，一种是动态扩缩容器。实际落地中我们发现扩容需求占到了很大一部分需求场景。可以基本忽略对容器的缩容的设计，因为现实情况下，业务容器是无法简单的线性缩小的。需要由运维来做容器规划并执行缩容操作。
4. 因为扩容需要考虑的因素众多，目前基本上无法在有状态服务上进行扩展。这是自动扩容的实际期望差距很大。目前Kubernetes的自动扩容仅仅是对无状态服务的支持。

### 4.3.1 自动扩容策略

#### 按规则扩容

按规则扩容可以根据应用的某些度量值进行扩容，以下是各个参数的含义：

* 实例数范围. 指定在自动扩容过程中，应用允许的最小的实例数和最大的实例数
* 周期间隔：自动扩容程序每隔多久检测一次应用状态
* 度量值：支持CPU，内存，QPS（响应时间），网络流量
* 周期：度量值到达条件的阈值

#### 按计划扩容

如需要在固定时间区间内操作容器扩缩，按计划扩容会更加合适。可以选择重复计划或者单次计划，在指定时间段时，自动扩容系统会调整相应的实例数。





## 4.4 总结



